#!/usr/bin/python3

import re, time, sys, signal, subprocess

def ctrl_c(sig, frame):
    print("[!] Quiting...")
    sys.exit(1)


def help_panel():
    print(f"Usage: python3 {sys.argv[0]} <ip_address>")
    sys.exit(1)

signal.signal(signal.SIGINT, ctrl_c)


def get_os(ttl):
    ttl = int(ttl)
    if ttl >= 0 and ttl <= 64:
        return "Linux"
    elif ttl >= 65 and ttl <= 128:
        return "Windows"
    else:
        return "Not found" 


def run():
    try:
        if len(sys.argv) == 2:
            ip_address = sys.argv[1]

            proc = subprocess.Popen(['/usr/bin/ping -c 1 %s' % ip_address, ""], stdout=subprocess.PIPE, shell=True)
            (out, err) = proc.communicate()

            out = out.split()
            out = out[12].decode('utf-8')

            ttl_value = re.findall(r"\d{1,3}", out)[0]
            os_name = get_os(ttl_value)
            print("%s (ttl --> %s): %s" % (ip_address, ttl_value, os_name))
        else:
            help_panel()
    except IndexError:
        print("Porfavor ingrese una ip valida.")
        sys.exit(1)


if __name__ == "__main__":
    run()
